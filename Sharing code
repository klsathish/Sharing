public class ActivityMonitoringRepository : IActivityMonitoringRepository
{
    private readonly SFDbContext _dbContext;

    public ActivityMonitoringRepository(SFDbContext dbContext)
    {
        _dbContext = dbContext;
    }

    #region Helpers

    private static object DbString(string? value) =>
        string.IsNullOrWhiteSpace(value) ? DBNull.Value : value;

    private static object DbValue<T>(T? value) where T : struct =>
        value ?? (object)DBNull.Value;

    #endregion

    public async Task<List<LoginActivityResults>> GetLoginActivity(DateFilter model)
    {
        return await _dbContext.LoginActivityResults
            .FromSqlRaw(
                "EXEC dbo.SP_GetLoginActivity @FromDate, @ToDate",
                new SqlParameter("@FromDate", DbValue(model.FromDate)),
                new SqlParameter("@ToDate", DbValue(model.ToDate))
            )
            .ToListAsync();
    }

    public async Task<List<UserActivityResults>> GetLoginUserActivity(DateFilter model)
    {
        return await _dbContext.UserActivityResults
            .FromSqlRaw(
                "EXEC dbo.SP_GetLoginUserActivity @FromDate, @ToDate",
                new SqlParameter("@FromDate", DbValue(model.FromDate)),
                new SqlParameter("@ToDate", DbValue(model.ToDate))
            )
            .ToListAsync();
    }

    public async Task InsertUserActivity(InsertUserActivity insertUserActivity)
    {
        await _dbContext.Database.ExecuteSqlRawAsync(
            "EXEC dbo.SP_Insert_Update_ActivityTracker " +
            "@ActivityTrackerID, @CreatedBy, @FunctionID, @ScreenID, @UserActionID",
            new SqlParameter("@ActivityTrackerID", DbValue(insertUserActivity.ActivityTrackerID)),
            new SqlParameter("@CreatedBy", DbString(insertUserActivity.CreatedBy)),
            new SqlParameter("@FunctionID", DbValue(insertUserActivity.FunctionID)),
            new SqlParameter("@ScreenID", DbValue(insertUserActivity.ScreenID)),
            new SqlParameter("@UserActionID", DbValue(insertUserActivity.UserActionID))
        );
    }
}
