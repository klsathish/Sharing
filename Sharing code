



CREATE FUNCTION dbo.fn_GetPlantIds
(
    @RegionID      VARCHAR(MAX) = NULL,
    @CountryID     VARCHAR(MAX) = NULL,
    @CompanyCode   VARCHAR(MAX) = NULL,
    @ProfitCenter  VARCHAR(MAX) = NULL,
    @SBU           VARCHAR(MAX) = NULL
)
RETURNS TABLE
AS
RETURN
(
    SELECT DISTINCT
        pl.PlantID
    FROM MST_Plant pl
    INNER JOIN MST_Affiliate af
        ON af.AffiliateCode = pl.AffiliateCode
    INNER JOIN MST_Country c
        ON c.CountryID = af.CountryID
    INNER JOIN MST_Region r
        ON r.RegionID = c.RegionID
    WHERE
        -- First attachment params
        (
            @RegionID IS NULL
            OR r.RegionID IN (SELECT value FROM STRING_SPLIT(@RegionID, ','))
        )
        AND
        (
            @CountryID IS NULL
            OR c.CountryID IN (SELECT value FROM STRING_SPLIT(@CountryID, ','))
        )
        AND
        (
            @CompanyCode IS NULL
            OR af.CompanyCode IN (SELECT value FROM STRING_SPLIT(@CompanyCode, ','))
        )

        -- Second attachment conditions
        AND
        (
            @ProfitCenter IS NULL
            OR pl.ProfitCenterID IN (SELECT value FROM STRING_SPLIT(@ProfitCenter, ','))
        )
        AND
        (
            @SBU IS NULL
            OR pl.SBU IN (SELECT value FROM STRING_SPLIT(@SBU, ','))
        )
);








CREATE FUNCTION dbo.fn_GetPlantIds_JoinOnly
(
    @RegionID      VARCHAR(MAX) = NULL,
    @CountryID     VARCHAR(MAX) = NULL,
    @CompanyCode   VARCHAR(MAX) = NULL,
    @ProfitCenter  VARCHAR(MAX) = NULL,
    @SBU           VARCHAR(MAX) = NULL
)
RETURNS TABLE
AS
RETURN
(
    SELECT DISTINCT
        pl.PlantID
    FROM MST_Plant pl

    INNER JOIN MST_Affiliate af
        ON af.AffiliateCode = pl.AffiliateCode

    INNER JOIN MST_Country c
        ON c.CountryID = af.CountryID

    INNER JOIN MST_Region r
        ON r.RegionID = c.RegionID

    -- ðŸ”¹ Attachment joins
    LEFT JOIN STRING_SPLIT(@RegionID, ',')      sr ON r.RegionID = sr.value
    LEFT JOIN STRING_SPLIT(@CountryID, ',')     sc ON c.CountryID = sc.value
    LEFT JOIN STRING_SPLIT(@CompanyCode, ',')   scc ON af.CompanyCode = scc.value
    LEFT JOIN STRING_SPLIT(@ProfitCenter, ',')  spc ON pl.ProfitCenterID = spc.value
    LEFT JOIN STRING_SPLIT(@SBU, ',')            ss ON pl.SBU = ss.value

    WHERE
        -- ðŸ”¹ If param is NULL â†’ ignore filter
        (@RegionID     IS NULL OR sr.value IS NOT NULL)
        AND (@CountryID    IS NULL OR sc.value IS NOT NULL)
        AND (@CompanyCode  IS NULL OR scc.value IS NOT NULL)
        AND (@ProfitCenter IS NULL OR spc.value IS NOT NULL)
        AND (@SBU          IS NULL OR ss.value IS NOT NULL)
);







Hi Khalid,

Greetings.

As discussed with Harish, he prefers that all planned changes are fully completed and finalized before proceeding with the code review. Once the development activities are completed and the code is officially frozen, we will inform him so that he can begin the review process.

Currently, we are still working on the WCI enhancements, and the corresponding pull request remains open. Since the PR is active, the updates being pushed to the development branch will continue to include our daily incremental changes. Alongside this, we are also addressing and incorporating the existing code review comments to ensure alignment with the expected standards.

Once the WCI enhancements are completed and no further changes are required, we will proceed with the development freeze and notify Harish accordingly.

Please let me know if any further clarification is required.

Thanks,
Sathish





Hi Khalid,
 
Greetings.
 
As discussed with Harish, he would like all changes to be fully in place before proceeding with the review. Once the code is frozen, we will inform him so that he can carry out the review.
 
Currently, we are still in progress with the WCI enhancements, and the pull request is active. Since the PR is open, the changes being pushed to the development branch will include our ongoing daily updates. In parallel, we are also addressing the code review comments.
 
Please let me know if any clarification is required.
 
