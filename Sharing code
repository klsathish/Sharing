dbo.sp_model_input_fg (Finished Goods)
CREATE OR ALTER PROCEDURE dbo.sp_model_input_fg
AS
BEGIN
    SET NOCOUNT ON;

    SELECT
        mm.material_number                              AS material_number,
        mm.unit_of_measure                              AS unit_of_measure,
        mm.calmonth                                     AS calmonth,
        mm.plant                                        AS plant,
        mm.profit_center                                AS profit_center,
        mm.material_type                                AS materialtype,
        mm.master_category                              AS Classification_level1,
        SUM(mm.quantity_in_mt)                          AS TotalQuant,
        SUM(mm.amount_in_sar)                           AS TotalValue_SAR,
        mm.sbu                                          AS sbu,
        mm.bu                                           AS bu,
        mm.sub_bu                                       AS sub_bu
    FROM staging.materials_movement mm
    WHERE mm.material_type = 'FG'
    GROUP BY
        mm.material_number,
        mm.unit_of_measure,
        mm.calmonth,
        mm.plant,
        mm.profit_center,
        mm.material_type,
        mm.master_category,
        mm.sbu,
        mm.bu,
        mm.sub_bu;
END;
GO

2Ô∏è‚É£ dbo.sp_model_input_rm (Raw Material)
CREATE OR ALTER PROCEDURE dbo.sp_model_input_rm
AS
BEGIN
    SET NOCOUNT ON;

    SELECT
        mm.material_number                              AS material_number,
        mm.unit_of_measure                              AS unit_of_measure,
        mm.calmonth                                     AS calmonth,
        mm.plant                                        AS plant,
        mm.profit_center                                AS profit_center,
        mm.material_type                                AS materialtype,
        mm.master_category                              AS Classification_level1,
        SUM(mm.quantity_in_mt)                          AS TotalQuant,
        SUM(mm.amount_in_sar)                           AS TotalValue_SAR,
        mm.sbu                                          AS sbu,
        mm.bu                                           AS bu,
        mm.sub_bu                                       AS sub_bu
    FROM staging.materials_movement mm
    WHERE mm.material_type = 'RM'
    GROUP BY
        mm.material_number,
        mm.unit_of_measure,
        mm.calmonth,
        mm.plant,
        mm.profit_center,
        mm.material_type,
        mm.master_category,
        mm.sbu,
        mm.bu,
        mm.sub_bu;
END;
GO

üîπ VIEWS
3Ô∏è‚É£ dbo.view_profitcenter_master
CREATE OR ALTER VIEW dbo.view_profitcenter_master
AS
SELECT DISTINCT
    profit_center        AS ProfitCenterID,
    profit_center        AS ProfitCenterName,
    sbu                  AS SBUID,
    sbu                  AS SBU,
    bu                   AS BUID,
    bu                   AS BU,
    sub_bu               AS Sub_BUID,
    sub_bu               AS Sub_BU,
    NULL                 AS AffiliateID,
    NULL                 AS AffiliateCode,
    NULL                 AS AffiliateName
FROM staging.materials_movement;
GO

4Ô∏è‚É£ dbo.view_model_input_demand_plan
CREATE OR ALTER VIEW dbo.view_model_input_demand_plan
AS
SELECT
    calmonth,
    ship_to_country,
    planning_region,
    material_number,
    demandplan_agreed,
    market_demand,
    snop_adjustments,
    NULL AS plantID
FROM staging.demand_plan_polymers;
GO

5Ô∏è‚É£ dbo.view_model_input_production_plan
CREATE OR ALTER VIEW dbo.view_model_input_production_plan
AS
SELECT
    plant,
    calmonth,
    profit_center,
    running_plant,
    business_plan
FROM staging.gpm_business_plan;
GO

6Ô∏è‚É£ dbo.view_model_input_closing_inventory
CREATE OR ALTER VIEW dbo.view_model_input_closing_inventory
AS
SELECT
    calmonth,
    material_number,
    plant,
    profit_center,
    material_type,
    company_code,
    closing_inventory_value_sar,
    inventory_value_price_per_ton_sar,
    sbu,
    bu,
    sub_bu
FROM staging.closing_inventory;
GO
