public static class SqlParameterExtensions
{
    // INT
    public static object DbValue(this int? value) =>
        value.HasValue ? value.Value : DBNull.Value;

    // BOOL / BIT
    public static object DbValue(this bool? value) =>
        value.HasValue ? value.Value : DBNull.Value;

    // GUID â†’ VARCHAR (because DB column is VARCHAR)
    public static object DbGuidString(this Guid? value) =>
        value.HasValue ? value.Value.ToString() : DBNull.Value;

    // STRING
    public static object DbValue(this string value) =>
        string.IsNullOrWhiteSpace(value) ? DBNull.Value : value;

    // DATETIME
    public static object DbValue(this DateTime? value) =>
        value.HasValue ? value.Value : DBNull.Value;
}


        public async Task<CommonRes> AddorUpdateActionAsync(WorkFlowAction obj)
        {
            var loginId = obj.LoginId!.RemovePrefix();
            var response = await _bpmWorkflowService.SubmitWorkflowAsync(obj.RecommendationId!.Value, obj.Action!, loginId!, obj.Comments!, obj.NewRequest);
            var code = CommonMethod.GetStatusCodefromResponse(response);

            if(obj.NewRequest && obj.Action == "Reject")
            {
                var worklist = await _workflowRepository.GetWorkListDataByDetailsAsync(obj);
                await _workflowRepository.UpdateRecommendationStatus(obj.RecommendationId.Value, obj.Action!, obj.LoginId!, obj.Comments!, worklist.processActivityName!);
            }

            if (code == SabicConstants.SuccessStatusCode)
            {
                await _workflowRepository.AddorUpdateActionAsync(obj);

                if (!obj.NewRequest)
                {
                    var worklist = await _workflowRepository.GetWorkListDataByDetailsAsync(obj);
                    if (code == SabicConstants.SuccessStatusCode && (obj.Action == "Reject" || worklist.processActivityName == "SNOP Planner Review"))
                        await _workflowRepository.UpdateRecommendationStatus(obj.RecommendationId.Value, obj.Action!, obj.LoginId!, obj.Comments!,worklist.processActivityName!);
                }
            }

            return new CommonRes
            {
                StatusMessage = response,
                StatusCode = code,
            };
        }



---------------

 // 6. AddorUpdateActionAsync - Success
 [Fact]
 public async Task AddorUpdateActionAsync_Success()
 {
     var obj = new WorkFlowAction
     {
         RecommendationId = 10,
         Action = "Approve",
         LoginId = "DOMAIN\\User",
         Comments = "OK",
         NewRequest = false
     };


     var wl = new WorkList { processActivityName = "SNOP Planner Review" };

     _repo.Setup(x => x.GetWorkListDataByDetailsAsync(obj)).ReturnsAsync(wl);
     _repo.Setup(x => x.AddorUpdateActionAsync(obj)).Returns(Task.CompletedTask);
     _repo.Setup(x => x.GetWorkListDataByDetailsAsync(obj)).ReturnsAsync(new WorkList());
     _repo.Setup(x => x.UpdateRecommendationStatus(It.IsAny<int>(), It.IsAny<string>(), It.IsAny<string>(), It.IsAny<string>(), It.IsAny<string>())).Returns(Task.CompletedTask);
     _bpm.Setup(x => x.SubmitWorkflowAsync(10, "Approve", "User", "OK", false)).ReturnsAsync("Success");

     var res = await _service.AddorUpdateActionAsync(obj);

     Assert.Equal(SabicConstants.InternalError, res.StatusCode);
 }
