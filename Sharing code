



                    a.forecast_value_Purchase/1000000.0 +
                    a.forecast_value_Production_Output/1000000.0), 2
              ) AS VARCHAR(50))
            + ' M$' AS RecommendationMessage
        FROM SABIC_DT_Finance_WCI.dbo.view_fg_inventory_forecast a
        INNER JOIN SABIC_DT_Finance_Master.master.MST_Affiliate af
            ON af.AffiliateCode = a.AffiliateCode
        INNER JOIN SABIC_DT_Finance_Master.master.MST_Country c
            ON c.CountryID = af.CountryID
        INNER JOIN SABIC_DT_Finance_Master.master.MST_Region r
            ON r.RegionID = c.RegionID
        INNER JOIN SABIC_DT_Finance_Master.master.MST_ProfitCenter p
            ON a.bu = p.BU
           AND a.sbu = p.SBU
           AND a.profit_center = p.ProfitCenterName
        WHERE
            r.IsActive = 1
            AND c.IsActive = 1
            AND af.IsActive = 1
            AND CAST(REPLACE(a.[Month],'-','') AS INT)
                BETWEEN @FromDateCalMonth AND @ToDateCalMonth
            AND (@RegionID = '' OR r.RegionID IN (SELECT value FROM STRING_SPLIT(@RegionID, ',')))
            AND (@CountryID = '' OR c.CountryID IN (SELECT value FROM STRING_SPLIT(@CountryID, ',')))
            AND (@BU = '' OR a.bu IN (SELECT value FROM STRING_SPLIT(@BU, ',')))
            AND (@SBU = '' OR a.sbu IN (SELECT value FROM STRING_SPLIT(@SBU, ',')))
            AND (@ProfitCenterID = '' OR p.ProfitCenterName IN (SELECT ProfitCenterName FROM @ProfitCenterValues))
        GROUP BY
            r.RegionID,
            r.RegionName,
            r.Latitude,
            r.Longitude;
    END
END
