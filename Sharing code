    public class WorkflowRepository : IWorkflowRepository
    {
        private readonly SFDbContext _db;
        private readonly WorkFlowDbContext _workFlowDb;
        public WorkflowRepository(SFDbContext dbContext, WorkFlowDbContext workFlowDbContext)
        {
            _db = dbContext;
            _workFlowDb = workFlowDbContext;
        }


        public async Task<WorkListWithSummaryModel> GetAllAsync(WorkFlowAction obj)
        {
            var WorkflowDetail = new WorkListWithSummaryModel();

            var _RecommendationsStatistics = _db.RecommendationsStatistics.FromSqlRaw("EXEC [dbo].[SP_GetRecommendationsStatistics]").ToListAsync();
            var RecommendationsStatistics = _RecommendationsStatistics.Result.FirstOrDefault();

            var WorkRecommendation = _workFlowDb.WorkList.FromSqlRaw("EXEC [dbo].[SP_GetWorklistByDomainLoginID] {0}", obj.LoginId!).ToListAsync();

            await Task.WhenAll(_RecommendationsStatistics, WorkRecommendation);

            WorkflowDetail.RecommendationsStatistics = RecommendationsStatistics;
            WorkflowDetail.WorkList = await WorkRecommendation;

            return WorkflowDetail;
        }


        public async Task<WorkList> GetWorkListDataByDetailsAsync(WorkFlowAction obj)
        {
            var res = await _workFlowDb.WorkList.FromSqlRaw("EXEC [dbo].[SP_GetWorklistByDomainLoginID] {0},{1}", obj.LoginId!, obj.RecommendationId!).ToListAsync();
            return res.FirstOrDefault() ?? new WorkList();
        }


        public async Task<WorkListChangeActionsModel> GetDetailsAsync(int requestNumber, string taskName)
        {
            var WorkflowDetail = new WorkListChangeActionsModel();

            var changeVolume = await _workFlowDb.WorkListtRecommendationDetails.FromSqlRaw("EXEC [dbo].[SP_GetWorkListChangeSellingVolumeDetails] {0}", requestNumber).AsNoTracking().ToListAsync().ConfigureAwait(false);

            var actionHistory = await _workFlowDb.WorkListActionHistory.FromSqlRaw("EXEC [dbo].[SP_GetWorklistActionHistoryByRecommendationID] {0}", requestNumber).AsNoTracking().ToListAsync().ConfigureAwait(false);

            var takeActions = await _workFlowDb.WorkListRequestAction.FromSqlRaw("EXEC [dbo].[SP_GetWorkflowTaskActionsByTaskName] {0}", taskName).AsNoTracking().ToListAsync().ConfigureAwait(false);

            WorkflowDetail.WorkListtRecommendationDetails = changeVolume.FirstOrDefault();
            WorkflowDetail.WorkListActionHistory = actionHistory;
            WorkflowDetail.WorkListRequestAction = takeActions;

            return WorkflowDetail;
        }
        public async Task<List<WorkListRegionContributor>> GetRegionContributorAsync(int requestNumber)
        {
            return await _db.WorkListRegionContributor.FromSqlRaw("EXEC [dbo].[SP_GetWorkListRegionDetails] {0}", requestNumber).ToListAsync();
        }


        public async Task AddorUpdateActionAsync(WorkFlowAction obj) =>
            await _workFlowDb.Database.ExecuteSqlRawAsync("EXEC [dbo].[SP_Insert_Update_SF_WorkflowDetails] {0},{1},{2},{3}",
               obj.RecommendationId!,
               obj.Action!,
               obj.LoginId!,
               obj.Comments!);

        #region WorkFlow Redirect

        public async Task<IEnumerable<WorkflowRedirect>> GetAllRedirectsAsync() =>
            await _workFlowDb.WorkflowRedirect.FromSqlRaw("EXEC [dbo].[SP_GetRedirectionWorklist]").ToListAsync();

        public async Task AddorUpdateRedirectAsync(WorkflowRedirect redirect)
        {
            await _workFlowDb.Database.ExecuteSqlRawAsync("EXEC [dbo].[SP_Insert_Update_WorklistRedirection] {0},{1},{2},{3},{4}",
               redirect.RecommendationRequestID!,
               redirect.FromUserDomainLoginID!,
               redirect.ToUserDomainLoginID!,
               redirect.Reason!,
               redirect.CreatedBy!);
        }

        #endregion

        #region Delegation

        public async Task<IEnumerable<WorkflowDelegation>> GetDelegationListAsync(WorkflowDelegation model) =>
            await _workFlowDb.WorkflowDelegation.FromSqlRaw("EXEC [dbo].[SP_GetDelegationDetailsByID] {0}", model.DelegationID == 0 ? null : model.DelegationID).ToListAsync();

        public async Task AddorUpdateDelegationAsync(WorkflowDelegation obj) =>
            await _workFlowDb.Database.ExecuteSqlRawAsync("EXEC [dbo].[SP_Insert_Update_Delegation] {0},{1},{2},{3},{4},{5},{6},{7}",
                obj.DelegationID!,
                obj.FromUserDomainLoginID!,
                obj.ToUserDomainLoginID!,
                obj.StartDate!,
                obj.EndDate!,
                obj.Reason!,
                obj.IsActive == true ? 1 : 0,
                obj.CreatedBy!);

        #endregion

        public async Task UpdateRecommendationStatus(int recommendationRequestId, string actionTaken, string actionTakenBy, string comments, string workFlowStageName) =>
            await _db.Database.ExecuteSqlRawAsync("EXEC [dbo].[SP_Update_RecommendationStatus] {0},{1},{2},{3},{4}", recommendationRequestId, actionTaken, actionTakenBy, comments, workFlowStageName);
    }
