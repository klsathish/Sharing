 public async Task<ClosingInventoryBalanceDetailChartModel> GetClosingInventoryBalanceDetailChart(ChartDataFilterReq chartDataFilterReq)
 {
     var filterRes = new ClosingInventoryBalanceDetailChartModel();
     var tempDate = string.IsNullOrEmpty(chartDataFilterReq.SelectedMonth) ? chartDataFilterReq.FromDate!.Value.ToString("MMM yyyy").ToUpper() : chartDataFilterReq.SelectedMonth;
     var (fromDate, toDate) = GetStartandEndDate(tempDate); // DEC 2023
     if (string.IsNullOrEmpty(chartDataFilterReq.SelectedMonth))
     {
         chartDataFilterReq.FromDate = chartDataFilterReq.FromDate;
         chartDataFilterReq.ToDate = chartDataFilterReq.ToDate;
     }
     else
     {
         chartDataFilterReq.FromDate = fromDate;
         chartDataFilterReq.ToDate = toDate;
     }
     var result = await _dashboardRepository.GetClosingInventoryBalanceDetailChart(chartDataFilterReq);

     var FGResult = result?.Where(x => x.InventoryType == "Finished Goods").ToList();
     var RMResult = result?.Where(x => x.InventoryType == "Raw Materials").ToList();


     if (FGResult != null || RMResult != null)
     {
         // Finished Goods
         var (FGchartData, FGgridList) = getFilteredClosingInventoryDetailList(chartDataFilterReq, FGResult, chartDataFilterReq.Metrics == 1 ? "Value" : "Volume");
         filterRes.FGClosingInventoryBalanceDetailsChart = FGgridList;
         filterRes.FGChartData = FGchartData;

         //Raw Materials
         var (RMchartData, RMgridList) = getFilteredClosingInventoryDetailList(chartDataFilterReq, RMResult, chartDataFilterReq.Metrics == 1 ? "Value" : "Volume");
         filterRes.RMClosingInventoryBalanceDetailsChart = RMgridList;
         filterRes.RMChartData = RMchartData;

         filterRes.StatusMessage = SabicConstants.SuccessMessage;
         filterRes.StatusCode = SabicConstants.SuccessStatusCode;
     }
     else
     {
         filterRes.StatusMessage = SabicConstants.RecordNotFoundMessage;
         filterRes.StatusCode = SabicConstants.RecordNotFoundStatusCode;
     }
     return filterRes;
 }

 public (List<ClosingInventoryBalanceChartFormat>, List<object>) getFilteredClosingInventoryDetailList(ChartDataFilterReq chartDataFilterReq, List<ClosingInventoryBalanceDetailChart> result, string type)
 {
     if (result != null && result.Count > 0)
     {
         var props = result.First().GetType().GetProperties();
         var groupValues = new Dictionary<string, double>();
         var totals = new ClosingInventoryBalanceDetailChart();

         var filteredProps = props
             .Where(p => p.Name.Contains(type, StringComparison.OrdinalIgnoreCase))
             .ToList();

         foreach (var row in result)
         {
             foreach (var prop in filteredProps)
             {
                 if (prop.Name != "CalYear" && prop.Name != "CalMonth" && prop.Name != "CalYear" && prop.Name != "InventoryType" && prop.Name != "CompanyCode")
                 {
                     var displayAttr = prop.GetCustomAttribute<System.ComponentModel.DataAnnotations.DisplayAttribute>();
                     var jsonAttr = prop.GetCustomAttribute<System.Text.Json.Serialization.JsonPropertyNameAttribute>();

                     var displayName = jsonAttr?.Name ?? displayAttr?.Name ?? prop.Name;

                     var value = prop.GetValue(row);
                     if (value != null && double.TryParse(value.ToString(), out double numbericValue))
                     {
                         if (groupValues.ContainsKey(displayName))
                             groupValues[displayName] += numbericValue;
                         else
                             groupValues[displayName] = numbericValue;
                     }
                 }
             }
         }

         var chartData = groupValues.Select(g => new ClosingInventoryBalanceChartFormat
         {
             x = g.Key.Replace("_", " "),
             y = Math.Round(g.Value, 2)
         }).ToList();


         foreach (var prop in filteredProps)
         {
             if (prop.Name != "CalYear" && prop.Name != "CalMonth" && prop.Name != "CalYear" && prop.Name != "InventoryType" && prop.Name != "CompanyCode")
             {
                 {
                     double sum = result.Sum(r => Convert.ToDouble(prop.GetValue(r) ?? 0));
                     prop.SetValue(totals, Math.Round(sum, 2));
                 }
             }
         }

         var gridList = new List<ClosingInventoryBalanceDetailChart> { totals };
         var filteredList = new List<object>();

         foreach (var row in gridList)
         {
             var dict = new Dictionary<string, double>();

             foreach (var prop in filteredProps)
             {
                 var displayAttr = prop.GetCustomAttribute<System.ComponentModel.DataAnnotations.DisplayAttribute>();
                 var jsonAttr = prop.GetCustomAttribute<System.Text.Json.Serialization.JsonPropertyNameAttribute>();

                 var displayName = jsonAttr?.Name ?? displayAttr?.Name ?? prop.Name;

                 var val = prop.GetValue(row);
                 if (val != null && double.TryParse(val.ToString(), out double num))
                     dict[displayName] = Math.Round(num, 2);
             }

             filteredList.Add(dict);
         }

         return (chartData, filteredList);
     }

     return (null, null);
 }
  public class ClosingInventoryBalanceDetailChartModel : CommonRes
  {
      public List<ClosingInventoryBalanceChartFormat>? FGChartData { get; set; }
      public List<ClosingInventoryBalanceChartFormat>? RMChartData { get; set; }
      public List<ClosingInventoryBalanceChartFormat>? AllChartData { get; set; }

      public List<object>? FGClosingInventoryBalanceDetailsChart { get; set; }
      public List<object>? RMClosingInventoryBalanceDetailsChart { get; set; }
      public List<object>? AllClosingInventoryBalanceDetailsChart { get; set; }
  }
